default_language_version:
  python: python3.12

repos:
  # General file fixes
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v5.0.0
    hooks:
      - id: trailing-whitespace
        name: Trim trailing whitespace
      - id: end-of-file-fixer
        name: Fix end of files
      - id: check-yaml
        name: Check YAML syntax
        args: ["--unsafe"]  # Allow Python constructors in mkdocs.yml
        exclude: "{{cookiecutter"
      - id: check-json
        name: Check JSON syntax
        exclude: "(devcontainer\\.json|\\.mcp\\.json)"  # These have trailing commas (JSONC)
      - id: check-toml
        name: Check TOML syntax
        exclude: "{{cookiecutter"
      - id: check-added-large-files
        name: Check for large files
        args: ["--maxkb=1000"]
      - id: check-case-conflict
        name: Check for case conflicts
      - id: check-merge-conflict
        name: Check for merge conflicts
      - id: detect-private-key
        name: Detect private keys
      - id: mixed-line-ending
        name: Fix mixed line endings
        args: ["--fix=lf"]

  # Markdown linting (skip cookiecutter template files)
  - repo: https://github.com/igorshubovych/markdownlint-cli
    rev: v0.43.0
    hooks:
      - id: markdownlint
        name: Lint markdown files
        args: ["--fix", "--disable", "MD013", "--disable", "MD033", "--disable", "MD041"]
        exclude: "{{cookiecutter"

  # YAML linting (skip cookiecutter template files)
  - repo: https://github.com/adrienverge/yamllint
    rev: v1.35.1
    hooks:
      - id: yamllint
        name: Lint YAML files
        args: ["-d", "relaxed"]
        exclude: "{{cookiecutter"

  # Local hooks
  - repo: local
    hooks:
      # Test template generation (manual - run with: pre-commit run --hook-stage manual test-template)
      - id: test-template
        name: Test cookiecutter generation
        entry: bash -c 'rm -rf /tmp/pre-commit-test && cookiecutter . --no-input -o /tmp project_name="pre-commit-test" >/dev/null 2>&1 && cd /tmp/pre-commit-test && uv sync --quiet && uv run pytest -q && rm -rf /tmp/pre-commit-test'
        language: system
        pass_filenames: false
        stages: [manual]

      # Verify cookiecutter.json is valid
      - id: check-cookiecutter
        name: Validate cookiecutter.json
        entry: python3 -c "import json; json.load(open('cookiecutter.json'))"
        language: system
        files: cookiecutter.json
        pass_filenames: false

ci:
  autofix_prs: true
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes from hooks

    for more information, see https://pre-commit.ci
  autoupdate_schedule: weekly
  autoupdate_commit_msg: "[pre-commit.ci] pre-commit autoupdate"
  skip: [test-template]  # Requires cookiecutter and uv installed
