# {{ cookiecutter.project_name }} - Development Commands
# Run `just --list` to see all available recipes

# Default recipe: show help
default:
    @just --list

# ============================================================================
# Development Setup
# ============================================================================

# Install dependencies (including dev dependencies)
install:
    uv sync --all-extras

# Install only production dependencies
install-prod:
    uv sync

# ============================================================================
# Running
# ============================================================================

# Start the API server
serve *ARGS:
    uv run {{ cookiecutter.project_slug|replace('-', '_') }} serve {{ARGS}}

# Start API server in development mode with auto-reload
dev:
    uv run uvicorn {{ cookiecutter.project_slug|replace('-', '_') }}.api.main:app --reload --host 0.0.0.0 --port {{ cookiecutter.app_port }}

# Run CLI command
cli *ARGS:
    uv run {{ cookiecutter.project_slug|replace('-', '_') }} {{ARGS}}

# ============================================================================
# Code Quality
# ============================================================================

# Run all checks (lint, typecheck, test)
check: lint typecheck test

# Run linter
lint:
    uv run ruff check src/ tests/

# Run linter and fix issues
lint-fix:
    uv run ruff check src/ tests/ --fix

# Format code
format:
    uv run ruff format src/ tests/

# Check formatting without changing files
format-check:
    uv run ruff format --check src/ tests/

# Run type checker
typecheck:
    uv run mypy src/

# Run security scan
security:
    uv run bandit -r src/

# ============================================================================
# Testing
# ============================================================================

# Run all tests
test *ARGS:
    uv run pytest {{ARGS}}

# Run tests with coverage
test-cov:
    uv run pytest --cov=src --cov-report=term --cov-report=html

# Run tests in watch mode (requires pytest-watch)
test-watch:
    uv run pytest-watch

# Run only unit tests
test-unit:
    uv run pytest tests/unit/

# Run only integration tests
test-integration:
    uv run pytest tests/integration/

# ============================================================================
# Build & Release
# ============================================================================

# Build the package
build:
    uv build

# Clean build artifacts
clean:
    rm -rf build/ dist/ *.egg-info .pytest_cache/ .mypy_cache/ .ruff_cache/ htmlcov/
    find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true

# Show current version
version:
    @uv run python -c "from {{ cookiecutter.project_slug|replace('-', '_') }} import __version__; print(__version__)"

# ============================================================================
# Documentation
# ============================================================================

# Build documentation
docs-build:
    uv run mkdocs build

# Serve documentation locally
docs-serve:
    uv run mkdocs serve

# ============================================================================
# Database (when applicable)
# ============================================================================

# Start local database services
db-up:
    docker compose -f docker-compose.yml up -d postgres

# Stop local database services
db-down:
    docker compose -f docker-compose.yml down

# ============================================================================
# Docker
# ============================================================================

# Build Docker image
docker-build:
    docker build -t {{ cookiecutter.project_slug }}:latest .

# Run Docker container
docker-run:
    docker run -p {{ cookiecutter.app_port }}:{{ cookiecutter.app_port }} {{ cookiecutter.project_slug }}:latest

# Start all services with docker-compose
up:
    docker compose up -d

# Stop all services
down:
    docker compose down

# View logs
logs *ARGS:
    docker compose logs {{ARGS}}

# ============================================================================
# Git Shortcuts
# ============================================================================

# Quick save: add all, commit with message
save MESSAGE:
    git add -A && git commit -m "{{MESSAGE}}"

# Undo last commit (keep changes)
undo:
    git reset --soft HEAD~1
